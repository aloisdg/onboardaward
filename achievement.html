<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Onboardaward</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css"
    />

    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèÖ</text></svg>"
    />
    <style>
      .gray {
        color: var(--form-placeholder);
      }
      .grid {
        display: grid;
      }
      .grid-auto-2-1 {
        grid-template-columns: auto 2fr 1fr;
      }

      .p2 {
        padding: 0.5rem;
      }

      .mb-2 {
        padding-bottom: 0.5rem;
      }

      .flex {
        display: flex;
      }
      .align-center {
        align-items: center;
      }

      .mr-2 {
        margin-right: 0.5rem;
      }

      .bg-dark {
        background-color: var(--background);
      }

      .border-dark {
        border: 3px solid var(--background);
      }

      ol {
        padding-left: 0;
      }

      .relative {
        position: relative;
      }

      .absolute {
        position: absolute;
      }

      .justify-right {
        justify-content: right;
      }
    </style>
  </head>
  <body>
    <header><h1>üèÖ Onboardaward</h1></header>

    <main>
      <div
        style="
          display: flex;
          align-items: center;
          margin-bottom: 1rem;
          margin-top: 2rem;
        "
      >
        <img
          src="https://user-images.githubusercontent.com/9153252/145385925-1f67e6be-4505-4c96-b6a6-2d140cee3391.jpeg"
          alt="avatar"
          style="
            margin-right: 1rem;
            width: 8rem;
            height: 8rem;
            border-radius: 50%;
          "
        />
        <div>
          <h2 style="margin-top: 12px">Jane Doe</h2>
          <h3 style="margin-top: 0">Account Manager</h3>
        </div>
      </div>

      <div class="relative border-dark" style="color: var(--code)">
        <div id="percent" class="absolute bg-dark" style="height: 24px"></div>
        <div id="progress" class="relative"></div>
      </div>

      <ol id="achievementBody"></ol>
    </main>

    <!-- Footer -->
    <footer class="bg-dark">
      <div class="align-center">
        <span class="">Vote for Onboardaward</span>
        <a
          href="https://github.com/aloisdg/onboardaward"
          class=""
          target="_blank"
          >Join us on Github</a
        >
      </div>
      <!-- Copyright -->
      <div class="align-center">
        ¬© 2021 Copyright:
        <a href="https://github.com/aloisdg/onboardaward">Onboardaward</a>
      </div>
      <!-- Copyright -->
    </footer>
    <!-- Footer -->

    <template id="achievementRow">
      <li class="grid grid-auto-2-1 mb-2">
        <section class="mr-2">
          <img style="width: 64px; height: 64px; object-fit: cover" src="" />
        </section>
        <section class="p2 flex align-center bg-dark"></section>
        <section
          class="p2 flex align-center bg-dark gray justify-right"
        ></section>
      </li>
    </template>

    <template id="ctaAskAFriend">
      <button
        style="
          padding-left: 0.5rem;
          padding-right: 0.5rem;
          display: flex;
          align-items: center;
        "
        data-mail=""
      >
        <span>Let me help</span>
        <img
          src=""
          height="35"
          width="35"
          style="border-radius: 50%; margin-left: 0.5rem"
        />
      </button>
    </template>

    <script>
      // https://steamcommunity.com/id/wolfdall/stats/367520?xml=1
      const steamResponse = {
        playerstats: {
          achievements: {
            achievement: [
              {
                description: "Acquire your first Charm",
                unlockTimestamp: "1588265392",
                _closed: "1",
                type: "meetup",
              },
              {
                description: "Acquire half of Hallownest's Charms",
                unlockTimestamp: "1589923164",
                _closed: "1",
                type: "meetup",
              },
              {
                description:
                  "Acquire all Charms and receive Salubra's blessing",
                unlockTimestamp: "1628250315",
                _closed: "1",
                type: "code",
              },
              {
                description: "Acquire 4 Mask Shards",
                unlockTimestamp: "1589720283",
                _closed: "1",
                type: "twitter",
              },
              {
                description: "Speak at a meetup",
                _closed: "0",
                type: "meetup",
              },
              {
                description: "Recommand someone to HR",
                _closed: "0",
                type: "hr",
              },
            ],
          },
        },
      };
    </script>

    <script>
      const achievementImages = {
        meetup: {
          buddy: "lorem@d-edge.com",
          buddyImage:
            "https://user-images.githubusercontent.com/9153252/145416508-0875be7c-719c-4df2-96c4-4e74e65a8b69.jpeg",
          image:
            "https://images.pexels.com/photos/2173508/pexels-photo-2173508.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260",
        },
        twitter: {
          buddy: "lorem@d-edge.com",
          buddyImage:
            "https://user-images.githubusercontent.com/9153252/145416559-347a16c9-394c-4b95-8ca3-86968004a569.jpeg",
          image:
            "https://images.pexels.com/photos/5417837/pexels-photo-5417837.jpeg?auto=compress&cs=tinysrgb&dpr=3&h=750&w=1260",
        },
        code: {
          buddy: "lorem@d-edge.com",
          buddyImage:
            "https://user-images.githubusercontent.com/9153252/145416612-583d83cc-938d-4fcc-868d-524b4eebab77.jpeg",
          image:
            "https://images.pexels.com/photos/160107/pexels-photo-160107.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260",
        },
        hr: {
          buddy: "lorem@d-edge.com",
          buddyImage:
            "https://user-images.githubusercontent.com/9153252/145416592-275ce606-d5fa-4554-8b20-2148f6a9e21b.jpeg",
          image:
            "https://images.pexels.com/photos/3746957/pexels-photo-3746957.jpeg?auto=compress&cs=tinysrgb&dpr=3&h=750&w=1260",
        },
      };
    </script>

    <script>
      const achievements =
        steamResponse.playerstats.achievements.achievement.map((x) => ({
          description: x.description,
          unlockTimestamp: x.unlockTimestamp,
          closed: x._closed === "1",
          type: achievementImages[x.type],
        }));

      const convertTimestamp = (timestamp) => {
        const date = new Date(timestamp * 1000);
        return `Unlocked ${date.toLocaleDateString()} üéâ`;
        // @ ${date.toLocaleTimeString()}`
      };

      const fillTemplate = (achievement) => {
        const clone = document.importNode(template.content, true);
        const col = clone.querySelectorAll("section");
        col[0].firstElementChild.src = achievement.type.image;
        col[1].textContent = achievement.description;

        if (achievement.closed) {
          col[2].textContent = convertTimestamp(achievement.unlockTimestamp);
        } else {
          const localButton = document.importNode(askAFriend.content, true);

          localButton.querySelector("img").src = achievement.type.buddyImage;
          localButton
            .querySelector("button")
            .setAttribute("data-mail", achievement.type.buddy);
          col[2].appendChild(localButton);
          col[0].firstElementChild.style.filter = "grayscale(1)";
        }
        return clone;
      };

      const tbody = document.querySelector("#achievementBody");
      const template = document.querySelector("#achievementRow");
      const progress = document.querySelector("#progress");
      const askAFriend = document.querySelector("#ctaAskAFriend");

      achievements.map(fillTemplate).forEach((clone) => {
        tbody.appendChild(clone);
      });

      const closedCount = achievements.filter((x) => x.closed).length;
      const totalCount = achievements.length;
      const percentCount = Math.round((closedCount / totalCount) * 100);
      progress.textContent = `${closedCount} of ${totalCount} (${percentCount}%) achievements earned`;
      percent.style.width = `${percentCount}%`;
    </script>
  </body>
</html>
